#!/usr/bin/env bash
set -euo pipefail

echo "Initializing pgcontents..."

DB_URL="${DATABASE_URL:-}"
if [[ "$DB_URL" == postgres://* ]]; then
  DB_URL="${DB_URL/postgres:/postgresql:}"
fi

pgcontents init --no-prompt -l "$DB_URL" || {
  echo "Error during the initialization of pgcontents"
  exit 1
}

echo "pgcontents initialized"

echo "Starting JupyterLab on Scalingo"

exec jupyter lab \
  --no-browser \
  --ServerApp.ip=0.0.0.0 \
  --ServerApp.port="${PORT:-8888}" \
  --ServerApp.token="${JUPYTER_TOKEN:-}" \
  --config=/app/jupyter_notebook_config.py
